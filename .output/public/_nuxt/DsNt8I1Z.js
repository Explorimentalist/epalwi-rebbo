var Ht=Object.defineProperty;var Gt=(z,h,m)=>h in z?Ht(z,h,{enumerable:!0,configurable:!0,writable:!0,value:m}):z[h]=m;var re=(z,h,m)=>Gt(z,typeof h!="symbol"?h+"":h,m);var ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kt(z){return z&&z.__esModule&&Object.prototype.hasOwnProperty.call(z,"default")?z.default:z}function se(z){throw new Error('Could not dynamically require "'+z+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var _e={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/var He;function Vt(){return He||(He=1,function(z,h){(function(m){z.exports=m()})(function(){return function m(_,O,I){function L(x,W){if(!O[x]){if(!_[x]){var d=typeof se=="function"&&se;if(!W&&d)return d(x,!0);if(b)return b(x,!0);var y=new Error("Cannot find module '"+x+"'");throw y.code="MODULE_NOT_FOUND",y}var R=O[x]={exports:{}};_[x][0].call(R.exports,function(C){var H=_[x][1][C];return L(H||C)},R,R.exports,m,_,O,I)}return O[x].exports}for(var b=typeof se=="function"&&se,N=0;N<I.length;N++)L(I[N]);return L}({1:[function(m,_,O){(function(I){var L=I.MutationObserver||I.WebKitMutationObserver,b;if(L){var N=0,x=new L(C),W=I.document.createTextNode("");x.observe(W,{characterData:!0}),b=function(){W.data=N=++N%2}}else if(!I.setImmediate&&typeof I.MessageChannel<"u"){var d=new I.MessageChannel;d.port1.onmessage=C,b=function(){d.port2.postMessage(0)}}else"document"in I&&"onreadystatechange"in I.document.createElement("script")?b=function(){var B=I.document.createElement("script");B.onreadystatechange=function(){C(),B.onreadystatechange=null,B.parentNode.removeChild(B),B=null},I.document.documentElement.appendChild(B)}:b=function(){setTimeout(C,0)};var y,R=[];function C(){y=!0;for(var B,G,P=R.length;P;){for(G=R,R=[],B=-1;++B<P;)G[B]();P=R.length}y=!1}_.exports=H;function H(B){R.push(B)===1&&!y&&b()}}).call(this,typeof ie<"u"?ie:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(m,_,O){var I=m(1);function L(){}var b={},N=["REJECTED"],x=["FULFILLED"],W=["PENDING"];_.exports=d;function d(l){if(typeof l!="function")throw new TypeError("resolver must be a function");this.state=W,this.queue=[],this.outcome=void 0,l!==L&&H(this,l)}d.prototype.catch=function(l){return this.then(null,l)},d.prototype.then=function(l,w){if(typeof l!="function"&&this.state===x||typeof w!="function"&&this.state===N)return this;var p=new this.constructor(L);if(this.state!==W){var A=this.state===x?l:w;R(p,A,this.outcome)}else this.queue.push(new y(p,l,w));return p};function y(l,w,p){this.promise=l,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof p=="function"&&(this.onRejected=p,this.callRejected=this.otherCallRejected)}y.prototype.callFulfilled=function(l){b.resolve(this.promise,l)},y.prototype.otherCallFulfilled=function(l){R(this.promise,this.onFulfilled,l)},y.prototype.callRejected=function(l){b.reject(this.promise,l)},y.prototype.otherCallRejected=function(l){R(this.promise,this.onRejected,l)};function R(l,w,p){I(function(){var A;try{A=w(p)}catch(F){return b.reject(l,F)}A===l?b.reject(l,new TypeError("Cannot resolve promise with itself")):b.resolve(l,A)})}b.resolve=function(l,w){var p=B(C,w);if(p.status==="error")return b.reject(l,p.value);var A=p.value;if(A)H(l,A);else{l.state=x,l.outcome=w;for(var F=-1,M=l.queue.length;++F<M;)l.queue[F].callFulfilled(w)}return l},b.reject=function(l,w){l.state=N,l.outcome=w;for(var p=-1,A=l.queue.length;++p<A;)l.queue[p].callRejected(w);return l};function C(l){var w=l&&l.then;if(l&&(typeof l=="object"||typeof l=="function")&&typeof w=="function")return function(){w.apply(l,arguments)}}function H(l,w){var p=!1;function A(Y){p||(p=!0,b.reject(l,Y))}function F(Y){p||(p=!0,b.resolve(l,Y))}function M(){w(F,A)}var U=B(M);U.status==="error"&&A(U.value)}function B(l,w){var p={};try{p.value=l(w),p.status="success"}catch(A){p.status="error",p.value=A}return p}d.resolve=G;function G(l){return l instanceof this?l:b.resolve(new this(L),l)}d.reject=P;function P(l){var w=new this(L);return b.reject(w,l)}d.all=ce;function ce(l){var w=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var p=l.length,A=!1;if(!p)return this.resolve([]);for(var F=new Array(p),M=0,U=-1,Y=new this(L);++U<p;)K(l[U],U);return Y;function K(k,ne){w.resolve(k).then(fe,function(Z){A||(A=!0,b.reject(Y,Z))});function fe(Z){F[ne]=Z,++M===p&&!A&&(A=!0,b.resolve(Y,F))}}}d.race=J;function J(l){var w=this;if(Object.prototype.toString.call(l)!=="[object Array]")return this.reject(new TypeError("must be an array"));var p=l.length,A=!1;if(!p)return this.resolve([]);for(var F=-1,M=new this(L);++F<p;)U(l[F]);return M;function U(Y){w.resolve(Y).then(function(K){A||(A=!0,b.resolve(M,K))},function(K){A||(A=!0,b.reject(M,K))})}}},{1:1}],3:[function(m,_,O){(function(I){typeof I.Promise!="function"&&(I.Promise=m(2))}).call(this,typeof ie<"u"?ie:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(m,_,O){var I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function L(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function b(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var N=b();function x(){try{if(!N||!N.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function W(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,a=new t,o=0;o<e.length;o+=1)a.append(e[o]);return a.getBlob(r.type)}}typeof Promise>"u"&&m(3);var d=Promise;function y(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function R(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function C(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function H(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var B="local-forage-detect-blob-support",G=void 0,P={},ce=Object.prototype.toString,J="readonly",l="readwrite";function w(e){for(var r=e.length,t=new ArrayBuffer(r),a=new Uint8Array(t),o=0;o<r;o++)a[o]=e.charCodeAt(o);return t}function p(e){return new d(function(r){var t=e.transaction(B,l),a=W([""]);t.objectStore(B).put(a,"key"),t.onabort=function(o){o.preventDefault(),o.stopPropagation(),r(!1)},t.oncomplete=function(){var o=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!o||parseInt(o[1],10)>=43)}}).catch(function(){return!1})}function A(e){return typeof G=="boolean"?d.resolve(G):p(e).then(function(r){return G=r,G})}function F(e){var r=P[e.name],t={};t.promise=new d(function(a,o){t.resolve=a,t.reject=o}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function M(e){var r=P[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function U(e,r){var t=P[e.name],a=t.deferredOperations.pop();if(a)return a.reject(r),a.promise}function Y(e,r){return new d(function(t,a){if(P[e.name]=P[e.name]||Ee(),e.db)if(r)F(e),e.db.close();else return t(e.db);var o=[e.name];r&&o.push(e.version);var n=N.open.apply(N,o);r&&(n.onupgradeneeded=function(i){var s=n.result;try{s.createObjectStore(e.storeName),i.oldVersion<=1&&s.createObjectStore(B)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),n.onerror=function(i){i.preventDefault(),a(n.error)},n.onsuccess=function(){var i=n.result;i.onversionchange=function(s){s.target.close()},t(i),M(e)}})}function K(e){return Y(e,!1)}function k(e){return Y(e,!0)}function ne(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),a=e.version<e.db.version,o=e.version>e.db.version;if(a&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function fe(e){return new d(function(r,t){var a=new FileReader;a.onerror=t,a.onloadend=function(o){var n=btoa(o.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},a.readAsBinaryString(e)})}function Z(e){var r=w(atob(e.data));return W([r],{type:e.type})}function Se(e){return e&&e.__local_forage_encoded_blob}function Ge(e){var r=this,t=r._initReady().then(function(){var a=P[r._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return R(t,e,e),t}function Ke(e){F(e);for(var r=P[e.name],t=r.forages,a=0;a<t.length;a++){var o=t[a];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,K(e).then(function(n){return e.db=n,ne(e)?k(e):n}).then(function(n){e.db=r.db=n;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=n}).catch(function(n){throw U(e,n),n})}function V(e,r,t,a){a===void 0&&(a=1);try{var o=e.db.transaction(e.storeName,r);t(null,o)}catch(n){if(a>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return d.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),k(e)}).then(function(){return Ke(e).then(function(){V(e,r,t,a-1)})}).catch(t);t(n)}}function Ee(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ve(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=e[a];var o=P[t.name];o||(o=Ee(),P[t.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=Ge);var n=[];function i(){return d.resolve()}for(var s=0;s<o.forages.length;s++){var c=o.forages[s];c!==r&&n.push(c._initReady().catch(i))}var f=o.forages.slice(0);return d.all(n).then(function(){return t.db=o.db,K(t)}).then(function(u){return t.db=u,ne(t,r._defaultConfig.version)?k(t):u}).then(function(u){t.db=o.db=u,r._dbInfo=t;for(var v=0;v<f.length;v++){var g=f[v];g!==r&&(g._dbInfo.db=t.db,g._dbInfo.version=t.version)}})}function Xe(e,r){var t=this;e=C(e);var a=new d(function(o,n){t.ready().then(function(){V(t._dbInfo,J,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.get(e);f.onsuccess=function(){var u=f.result;u===void 0&&(u=null),Se(u)&&(u=Z(u)),o(u)},f.onerror=function(){n(f.error)}}catch(u){n(u)}})}).catch(n)});return y(a,r),a}function Qe(e,r){var t=this,a=new d(function(o,n){t.ready().then(function(){V(t._dbInfo,J,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.openCursor(),u=1;f.onsuccess=function(){var v=f.result;if(v){var g=v.value;Se(g)&&(g=Z(g));var S=e(g,v.key,u++);S!==void 0?o(S):v.continue()}else o()},f.onerror=function(){n(f.error)}}catch(v){n(v)}})}).catch(n)});return y(a,r),a}function je(e,r,t){var a=this;e=C(e);var o=new d(function(n,i){var s;a.ready().then(function(){return s=a._dbInfo,ce.call(r)==="[object Blob]"?A(s.db).then(function(c){return c?r:fe(r)}):r}).then(function(c){V(a._dbInfo,l,function(f,u){if(f)return i(f);try{var v=u.objectStore(a._dbInfo.storeName);c===null&&(c=void 0);var g=v.put(c,e);u.oncomplete=function(){c===void 0&&(c=null),n(c)},u.onabort=u.onerror=function(){var S=g.error?g.error:g.transaction.error;i(S)}}catch(S){i(S)}})}).catch(i)});return y(o,t),o}function Je(e,r){var t=this;e=C(e);var a=new d(function(o,n){t.ready().then(function(){V(t._dbInfo,l,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.delete(e);s.oncomplete=function(){o()},s.onerror=function(){n(f.error)},s.onabort=function(){var u=f.error?f.error:f.transaction.error;n(u)}}catch(u){n(u)}})}).catch(n)});return y(a,r),a}function Ze(e){var r=this,t=new d(function(a,o){r.ready().then(function(){V(r._dbInfo,l,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.clear();i.oncomplete=function(){a()},i.onabort=i.onerror=function(){var f=c.error?c.error:c.transaction.error;o(f)}}catch(f){o(f)}})}).catch(o)});return y(t,e),t}function qe(e){var r=this,t=new d(function(a,o){r.ready().then(function(){V(r._dbInfo,J,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.count();c.onsuccess=function(){a(c.result)},c.onerror=function(){o(c.error)}}catch(f){o(f)}})}).catch(o)});return y(t,e),t}function ke(e,r){var t=this,a=new d(function(o,n){if(e<0){o(null);return}t.ready().then(function(){V(t._dbInfo,J,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=!1,u=c.openKeyCursor();u.onsuccess=function(){var v=u.result;if(!v){o(null);return}e===0||f?o(v.key):(f=!0,v.advance(e))},u.onerror=function(){n(u.error)}}catch(v){n(v)}})}).catch(n)});return y(a,r),a}function et(e){var r=this,t=new d(function(a,o){r.ready().then(function(){V(r._dbInfo,J,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.openKeyCursor(),f=[];c.onsuccess=function(){var u=c.result;if(!u){a(f);return}f.push(u.key),u.continue()},c.onerror=function(){o(c.error)}}catch(u){o(u)}})}).catch(o)});return y(t,e),t}function tt(e,r){r=H.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;if(!e.name)o=d.reject("Invalid arguments");else{var n=e.name===t.name&&a._dbInfo.db,i=n?d.resolve(a._dbInfo.db):K(e).then(function(s){var c=P[e.name],f=c.forages;c.db=s;for(var u=0;u<f.length;u++)f[u]._dbInfo.db=s;return s});e.storeName?o=i.then(function(s){if(s.objectStoreNames.contains(e.storeName)){var c=s.version+1;F(e);var f=P[e.name],u=f.forages;s.close();for(var v=0;v<u.length;v++){var g=u[v];g._dbInfo.db=null,g._dbInfo.version=c}var S=new d(function(E,T){var D=N.open(e.name,c);D.onerror=function($){var te=D.result;te.close(),T($)},D.onupgradeneeded=function(){var $=D.result;$.deleteObjectStore(e.storeName)},D.onsuccess=function(){var $=D.result;$.close(),E($)}});return S.then(function(E){f.db=E;for(var T=0;T<u.length;T++){var D=u[T];D._dbInfo.db=E,M(D._dbInfo)}}).catch(function(E){throw(U(e,E)||d.resolve()).catch(function(){}),E})}}):o=i.then(function(s){F(e);var c=P[e.name],f=c.forages;s.close();for(var u=0;u<f.length;u++){var v=f[u];v._dbInfo.db=null}var g=new d(function(S,E){var T=N.deleteDatabase(e.name);T.onerror=function(){var D=T.result;D&&D.close(),E(T.error)},T.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},T.onsuccess=function(){var D=T.result;D&&D.close(),S(D)}});return g.then(function(S){c.db=S;for(var E=0;E<f.length;E++){var T=f[E];M(T._dbInfo)}}).catch(function(S){throw(U(e,S)||d.resolve()).catch(function(){}),S})})}return y(o,r),o}var rt={_driver:"asyncStorage",_initStorage:Ve,_support:x(),iterate:Qe,getItem:Xe,setItem:je,removeItem:Je,clear:Ze,length:qe,key:ke,keys:et,dropInstance:tt};function nt(){return typeof openDatabase=="function"}var X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",at="~~local_forage_type~",Ie=/^~~local_forage_type~([^~]+)~/,ae="__lfsc__:",ue=ae.length,le="arbf",de="blob",Ae="si08",De="ui08",xe="uic8",Re="si16",Te="si32",Ne="ur16",Ce="ui32",Be="fl32",Oe="fl64",Le=ue+le.length,Pe=Object.prototype.toString;function Fe(e){var r=e.length*.75,t=e.length,a,o=0,n,i,s,c;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var f=new ArrayBuffer(r),u=new Uint8Array(f);for(a=0;a<t;a+=4)n=X.indexOf(e[a]),i=X.indexOf(e[a+1]),s=X.indexOf(e[a+2]),c=X.indexOf(e[a+3]),u[o++]=n<<2|i>>4,u[o++]=(i&15)<<4|s>>2,u[o++]=(s&3)<<6|c&63;return f}function he(e){var r=new Uint8Array(e),t="",a;for(a=0;a<r.length;a+=3)t+=X[r[a]>>2],t+=X[(r[a]&3)<<4|r[a+1]>>4],t+=X[(r[a+1]&15)<<2|r[a+2]>>6],t+=X[r[a+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function ot(e,r){var t="";if(e&&(t=Pe.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&Pe.call(e.buffer)==="[object ArrayBuffer]")){var a,o=ae;e instanceof ArrayBuffer?(a=e,o+=le):(a=e.buffer,t==="[object Int8Array]"?o+=Ae:t==="[object Uint8Array]"?o+=De:t==="[object Uint8ClampedArray]"?o+=xe:t==="[object Int16Array]"?o+=Re:t==="[object Uint16Array]"?o+=Ne:t==="[object Int32Array]"?o+=Te:t==="[object Uint32Array]"?o+=Ce:t==="[object Float32Array]"?o+=Be:t==="[object Float64Array]"?o+=Oe:r(new Error("Failed to get type for BinaryArray"))),r(o+he(a))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var i=at+e.type+"~"+he(this.result);r(ae+de+i)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),r(null,i)}}function it(e){if(e.substring(0,ue)!==ae)return JSON.parse(e);var r=e.substring(Le),t=e.substring(ue,Le),a;if(t===de&&Ie.test(r)){var o=r.match(Ie);a=o[1],r=r.substring(o[0].length)}var n=Fe(r);switch(t){case le:return n;case de:return W([n],{type:a});case Ae:return new Int8Array(n);case De:return new Uint8Array(n);case xe:return new Uint8ClampedArray(n);case Re:return new Int16Array(n);case Ne:return new Uint16Array(n);case Te:return new Int32Array(n);case Ce:return new Uint32Array(n);case Be:return new Float32Array(n);case Oe:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var ve={serialize:ot,deserialize:it,stringToBuffer:Fe,bufferToString:he};function ze(e,r,t,a){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,a)}function st(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=typeof e[a]!="string"?e[a].toString():e[a];var o=new d(function(n,i){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(s){return i(s)}t.db.transaction(function(s){ze(s,t,function(){r._dbInfo=t,n()},function(c,f){i(f)})},i)});return t.serializer=ve,o}function Q(e,r,t,a,o,n){e.executeSql(t,a,o,function(i,s){s.code===s.SYNTAX_ERR?i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(c,f){f.rows.length?n(c,s):ze(c,r,function(){c.executeSql(t,a,o,n)},n)},n):n(i,s)},n)}function ct(e,r){var t=this;e=C(e);var a=new d(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){Q(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(c,f){var u=f.rows.length?f.rows.item(0).value:null;u&&(u=i.serializer.deserialize(u)),o(u)},function(c,f){n(f)})})}).catch(n)});return y(a,r),a}function ft(e,r){var t=this,a=new d(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){Q(s,i,"SELECT * FROM "+i.storeName,[],function(c,f){for(var u=f.rows,v=u.length,g=0;g<v;g++){var S=u.item(g),E=S.value;if(E&&(E=i.serializer.deserialize(E)),E=e(E,S.key,g+1),E!==void 0){o(E);return}}o()},function(c,f){n(f)})})}).catch(n)});return y(a,r),a}function Me(e,r,t,a){var o=this;e=C(e);var n=new d(function(i,s){o.ready().then(function(){r===void 0&&(r=null);var c=r,f=o._dbInfo;f.serializer.serialize(r,function(u,v){v?s(v):f.db.transaction(function(g){Q(g,f,"INSERT OR REPLACE INTO "+f.storeName+" (key, value) VALUES (?, ?)",[e,u],function(){i(c)},function(S,E){s(E)})},function(g){if(g.code===g.QUOTA_ERR){if(a>0){i(Me.apply(o,[e,c,t,a-1]));return}s(g)}})})}).catch(s)});return y(n,t),n}function ut(e,r,t){return Me.apply(this,[e,r,t,1])}function lt(e,r){var t=this;e=C(e);var a=new d(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){Q(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){o()},function(c,f){n(f)})})}).catch(n)});return y(a,r),a}function dt(e){var r=this,t=new d(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){Q(i,n,"DELETE FROM "+n.storeName,[],function(){a()},function(s,c){o(c)})})}).catch(o)});return y(t,e),t}function ht(e){var r=this,t=new d(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){Q(i,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(s,c){var f=c.rows.item(0).c;a(f)},function(s,c){o(c)})})}).catch(o)});return y(t,e),t}function vt(e,r){var t=this,a=new d(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){Q(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,f){var u=f.rows.length?f.rows.item(0).key:null;o(u)},function(c,f){n(f)})})}).catch(n)});return y(a,r),a}function mt(e){var r=this,t=new d(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){Q(i,n,"SELECT key FROM "+n.storeName,[],function(s,c){for(var f=[],u=0;u<c.rows.length;u++)f.push(c.rows.item(u).key);a(f)},function(s,c){o(c)})})}).catch(o)});return y(t,e),t}function yt(e){return new d(function(r,t){e.transaction(function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(o,n){for(var i=[],s=0;s<n.rows.length;s++)i.push(n.rows.item(s).name);r({db:e,storeNames:i})},function(o,n){t(n)})},function(a){t(a)})})}function gt(e,r){r=H.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;return e.name?o=new d(function(n){var i;e.name===t.name?i=a._dbInfo.db:i=openDatabase(e.name,"","",0),e.storeName?n({db:i,storeNames:[e.storeName]}):n(yt(i))}).then(function(n){return new d(function(i,s){n.db.transaction(function(c){function f(S){return new d(function(E,T){c.executeSql("DROP TABLE IF EXISTS "+S,[],function(){E()},function(D,$){T($)})})}for(var u=[],v=0,g=n.storeNames.length;v<g;v++)u.push(f(n.storeNames[v]));d.all(u).then(function(){i()}).catch(function(S){s(S)})},function(c){s(c)})})}):o=d.reject("Invalid arguments"),y(o,r),o}var pt={_driver:"webSQLStorage",_initStorage:st,_support:nt(),iterate:ft,getItem:ct,setItem:ut,removeItem:lt,clear:dt,length:ht,key:vt,keys:mt,dropInstance:gt};function _t(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ue(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function bt(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function wt(){return!bt()||localStorage.length>0}function St(e){var r=this,t={};if(e)for(var a in e)t[a]=e[a];return t.keyPrefix=Ue(e,r._defaultConfig),wt()?(r._dbInfo=t,t.serializer=ve,d.resolve()):d.reject()}function Et(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);n.indexOf(a)===0&&localStorage.removeItem(n)}});return y(t,e),t}function It(e,r){var t=this;e=C(e);var a=t.ready().then(function(){var o=t._dbInfo,n=localStorage.getItem(o.keyPrefix+e);return n&&(n=o.serializer.deserialize(n)),n});return y(a,r),a}function At(e,r){var t=this,a=t.ready().then(function(){for(var o=t._dbInfo,n=o.keyPrefix,i=n.length,s=localStorage.length,c=1,f=0;f<s;f++){var u=localStorage.key(f);if(u.indexOf(n)===0){var v=localStorage.getItem(u);if(v&&(v=o.serializer.deserialize(v)),v=e(v,u.substring(i),c++),v!==void 0)return v}}});return y(a,r),a}function Dt(e,r){var t=this,a=t.ready().then(function(){var o=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(o.keyPrefix.length)),n});return y(a,r),a}function xt(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo,o=localStorage.length,n=[],i=0;i<o;i++){var s=localStorage.key(i);s.indexOf(a.keyPrefix)===0&&n.push(s.substring(a.keyPrefix.length))}return n});return y(t,e),t}function Rt(e){var r=this,t=r.keys().then(function(a){return a.length});return y(t,e),t}function Tt(e,r){var t=this;e=C(e);var a=t.ready().then(function(){var o=t._dbInfo;localStorage.removeItem(o.keyPrefix+e)});return y(a,r),a}function Nt(e,r,t){var a=this;e=C(e);var o=a.ready().then(function(){r===void 0&&(r=null);var n=r;return new d(function(i,s){var c=a._dbInfo;c.serializer.serialize(r,function(f,u){if(u)s(u);else try{localStorage.setItem(c.keyPrefix+e,f),i(n)}catch(v){(v.name==="QuotaExceededError"||v.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s(v),s(v)}})})});return y(o,t),o}function Ct(e,r){if(r=H.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var a=this,o;return e.name?o=new d(function(n){e.storeName?n(Ue(e,a._defaultConfig)):n(e.name+"/")}).then(function(n){for(var i=localStorage.length-1;i>=0;i--){var s=localStorage.key(i);s.indexOf(n)===0&&localStorage.removeItem(s)}}):o=d.reject("Invalid arguments"),y(o,r),o}var Bt={_driver:"localStorageWrapper",_initStorage:St,_support:_t(),iterate:At,getItem:It,setItem:Nt,removeItem:Tt,clear:Et,length:Rt,key:Dt,keys:xt,dropInstance:Ct},Ot=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},Lt=function(r,t){for(var a=r.length,o=0;o<a;){if(Ot(r[o],t))return!0;o++}return!1},Ye=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},ee={},$e={},q={INDEXEDDB:rt,WEBSQL:pt,LOCALSTORAGE:Bt},Pt=[q.INDEXEDDB._driver,q.WEBSQL._driver,q.LOCALSTORAGE._driver],oe=["dropInstance"],me=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(oe),Ft={description:"",driver:Pt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function zt(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function ye(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(Ye(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var Mt=function(){function e(r){L(this,e);for(var t in q)if(q.hasOwnProperty(t)){var a=q[t],o=a._driver;this[t]=o,ee[o]||this.defineDriver(a)}this._defaultConfig=ye({},Ft),this._config=ye({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":I(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var a in t){if(a==="storeName"&&(t[a]=t[a].replace(/\W/g,"_")),a==="version"&&typeof t[a]!="number")return new Error("Database version must be a number.");this._config[a]=t[a]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,a,o){var n=new d(function(i,s){try{var c=t._driver,f=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){s(f);return}for(var u=me.concat("_initStorage"),v=0,g=u.length;v<g;v++){var S=u[v],E=!Lt(oe,S);if((E||t[S])&&typeof t[S]!="function"){s(f);return}}var T=function(){for(var te=function($t){return function(){var Wt=new Error("Method "+$t+" is not implemented by the current driver"),We=d.reject(Wt);return y(We,arguments[arguments.length-1]),We}},ge=0,Yt=oe.length;ge<Yt;ge++){var pe=oe[ge];t[pe]||(t[pe]=te(pe))}};T();var D=function(te){ee[c]&&console.info("Redefining LocalForage driver: "+c),ee[c]=t,$e[c]=te,i()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(D,s):D(!!t._support):D(!0)}catch($){s($)}});return R(n,a,o),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,a,o){var n=ee[t]?d.resolve(ee[t]):d.reject(new Error("Driver not found."));return R(n,a,o),n},e.prototype.getSerializer=function(t){var a=d.resolve(ve);return R(a,t),a},e.prototype.ready=function(t){var a=this,o=a._driverSet.then(function(){return a._ready===null&&(a._ready=a._initDriver()),a._ready});return R(o,t,t),o},e.prototype.setDriver=function(t,a,o){var n=this;Ye(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){n._config.driver=n.driver()}function c(v){return n._extend(v),s(),n._ready=n._initStorage(n._config),n._ready}function f(v){return function(){var g=0;function S(){for(;g<v.length;){var E=v[g];return g++,n._dbInfo=null,n._ready=null,n.getDriver(E).then(c).catch(S)}s();var T=new Error("No available storage method found.");return n._driverSet=d.reject(T),n._driverSet}return S()}}var u=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=u.then(function(){var v=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(v).then(function(g){n._driver=g._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=f(i)})}).catch(function(){s();var v=new Error("No available storage method found.");return n._driverSet=d.reject(v),n._driverSet}),R(this._driverSet,a,o),this._driverSet},e.prototype.supports=function(t){return!!$e[t]},e.prototype._extend=function(t){ye(this,t)},e.prototype._getSupportedDrivers=function(t){for(var a=[],o=0,n=t.length;o<n;o++){var i=t[o];this.supports(i)&&a.push(i)}return a},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,a=me.length;t<a;t++)zt(this,me[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),Ut=new Mt;_.exports=Ut},{3:3}]},{},[4])(4)})}(_e)),_e.exports}var Xt=Vt();const be=Kt(Xt),we={name:"epalwi-dictionary",version:1,storeName:"dictionary-data",description:"Spanish-Ndowe Dictionary Offline Storage"},j={DICTIONARY_DATA:"dictionary-data",CACHE_METADATA:"cache-metadata",SEARCH_INDEX:"search-index",USER_PREFERENCES:"user-preferences"};class Qt{constructor(){re(this,"dictionaryStore");re(this,"metadataStore");re(this,"indexStore");re(this,"initialized",!1);this.dictionaryStore=be.createInstance({...we,storeName:"dictionary-entries"}),this.metadataStore=be.createInstance({...we,storeName:"cache-metadata"}),this.indexStore=be.createInstance({...we,storeName:"search-index"})}async initialize(){try{await this.dictionaryStore.ready(),await this.metadataStore.ready(),await this.indexStore.ready(),this.initialized=!0,console.log("üóÑÔ∏è IndexedDB service initialized successfully")}catch(h){throw console.error("‚ùå Failed to initialize IndexedDB:",h),this.createError("cache-error","Failed to initialize offline storage",h)}}async storeDictionaryData(h){this.ensureInitialized();try{const m=Date.now(),_=this.enhanceEntries(h.entries);await this.dictionaryStore.setItem(j.DICTIONARY_DATA,{metadata:h.metadata,entries:_});const O={lastUpdated:Date.now(),version:h.metadata.version,entriesCount:h.metadata.total_entries,sizeBytes:this.estimateDataSize(h),indexBuilt:!1,dataHash:"default-hash"};await this.metadataStore.setItem(j.CACHE_METADATA,O);const I=Date.now()-m;console.log(`üíæ Dictionary cached: ${h.metadata.total_entries} entries in ${I}ms`)}catch(m){throw console.error("‚ùå Failed to store dictionary data:",m),this.createError("cache-error","Failed to cache dictionary data",m)}}async loadDictionaryData(){this.ensureInitialized();try{const h=await this.dictionaryStore.getItem(j.DICTIONARY_DATA);return h?(console.log(`üìñ Loaded cached dictionary: ${h.entries.length} entries`),{metadata:h.metadata,entries:h.entries.map(m=>{const _={espa√±ol:m.espa√±ol};return m.ndowe&&(_.ndowe=m.ndowe),m.explicaci√≥n&&(_.explicaci√≥n=m.explicaci√≥n),m.ver&&(_.ver=m.ver),_})}):(console.log("üì≠ No cached dictionary data found"),null)}catch(h){throw console.error("‚ùå Failed to load dictionary data:",h),this.createError("cache-error","Failed to load cached dictionary",h)}}async getEnhancedEntries(){this.ensureInitialized();try{const h=await this.dictionaryStore.getItem(j.DICTIONARY_DATA);return(h==null?void 0:h.entries)||[]}catch(h){throw console.error("‚ùå Failed to get enhanced entries:",h),this.createError("cache-error","Failed to get enhanced entries",h)}}async getCacheMetadata(){this.ensureInitialized();try{return await this.metadataStore.getItem(j.CACHE_METADATA)}catch(h){return console.error("‚ùå Failed to get cache metadata:",h),null}}async isCacheValid(h){try{const m=await this.getCacheMetadata();if(!m)return!1;if(h&&m.version!==h)return console.log(`üîÑ Cache version mismatch: ${m.version} !== ${h}`),!1;const _=24*60*60*1e3;return Date.now()-m.lastUpdated<_?!0:(console.log("üïê Cache expired"),!1)}catch(m){return console.error("‚ùå Failed to validate cache:",m),!1}}async storeSearchIndex(h){this.ensureInitialized();try{await this.indexStore.setItem(j.SEARCH_INDEX,{data:h,timestamp:Date.now()});const m=await this.getCacheMetadata();m&&(m.indexBuilt=!0,await this.metadataStore.setItem(j.CACHE_METADATA,m)),console.log("üîç Search index cached successfully")}catch(m){throw console.error("‚ùå Failed to store search index:",m),this.createError("index-error","Failed to cache search index",m)}}async loadSearchIndex(){this.ensureInitialized();try{const h=await this.indexStore.getItem(j.SEARCH_INDEX);return h?(console.log("üîç Loaded cached search index"),h.data):(console.log("üîç No cached search index found"),null)}catch(h){return console.error("‚ùå Failed to load search index:",h),null}}async clearCache(){this.ensureInitialized();try{await Promise.all([this.dictionaryStore.clear(),this.metadataStore.clear(),this.indexStore.clear()]),console.log("üßπ Cache cleared successfully")}catch(h){throw console.error("‚ùå Failed to clear cache:",h),this.createError("cache-error","Failed to clear cache",h)}}async getStorageStats(){this.ensureInitialized();try{const[h,m,_]=await Promise.all([this.dictionaryStore.length(),this.metadataStore.length(),this.indexStore.length()]),O=await this.getCacheMetadata(),I=(O==null?void 0:O.sizeBytes)||0;return{dictionaryEntries:h,metadataItems:m,indexItems:_,estimatedSizeBytes:I}}catch(h){return console.error("‚ùå Failed to get storage stats:",h),{dictionaryEntries:0,metadataItems:0,indexItems:0,estimatedSizeBytes:0}}}enhanceEntries(h){return h.map((m,_)=>{var O,I,L,b,N,x;return{id:`entry-${_}`,espa√±ol:m.espa√±ol,espa√±olNormalized:this.normalizeText(m.espa√±ol),ndowe:m.ndowe||[],ndoweText:((O=m.ndowe)==null?void 0:O.join(" "))||"",explicaci√≥n:m.explicaci√≥n,ver:m.ver,tags:[],category:"general",searchableText:`${m.espa√±ol} ${((I=m.ndowe)==null?void 0:I.join(" "))||""} ${((L=m.explicaci√≥n)==null?void 0:L.join(" "))||""}`,hasTranslations:!!((b=m.ndowe)!=null&&b.length),hasExamples:!!((N=m.explicaci√≥n)!=null&&N.length),hasCrossReferences:!!((x=m.ver)!=null&&x.length)}})}normalizeText(h){return h.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").trim()}estimateDataSize(h){try{return new Blob([JSON.stringify(h)]).size}catch{return h.entries.length*150}}ensureInitialized(){if(!this.initialized)throw this.createError("cache-error","IndexedDB service not initialized")}createError(h,m,_){return{code:h,message:m,details:(_==null?void 0:_.message)||(_==null?void 0:_.toString())}}}const Zt=new Qt;export{Qt as IndexedDBService,Zt as indexedDBService};
